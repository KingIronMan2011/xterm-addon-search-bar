{"version":3,"file":"xterm-addon-search-bar.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/index.ts"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import { ITerminalAddon, Terminal } from 'xterm';\r\nimport { ISearchOptions, SearchAddon } from 'xterm-addon-search';\r\nimport './index.css';\r\n\r\nexport interface SearchBarOption extends ISearchOptions {\r\n  searchAddon: SearchAddon;\r\n}\r\n\r\nconst ADDON_MARKER_NAME = 'xterm-search-bar__addon';\r\n\r\nexport class SearchBarAddon implements ITerminalAddon {\r\n  private readonly options: Partial<SearchBarOption>;\r\n  private terminal: Terminal;\r\n  private readonly searchAddon: SearchAddon;\r\n  private searchBarElement: HTMLDivElement;\r\n  private searchKey: string;\r\n\r\n  constructor(options: Partial<SearchBarOption>) {\r\n    this.options = options || {};\r\n    if (this.options && this.options.searchAddon) {\r\n      this.searchAddon = this.options.searchAddon;\r\n    }\r\n  }\r\n\r\n  activate(terminal: Terminal): void {\r\n    this.terminal = terminal;\r\n    if (!this.searchAddon) {\r\n      console.error('Cannot use search bar addon until search addon has been loaded!');\r\n    }\r\n  }\r\n\r\n  dispose() {\r\n    this.hidden();\r\n  }\r\n\r\n  /**\r\n   *  Show the bar in the term\r\n   * @returns empty\r\n   * @memberof SearchBarAddon  necessary search addon instance\r\n   */\r\n  show() {\r\n    if (!this.terminal || !this.terminal.element) {\r\n      return;\r\n    }\r\n    if (this.searchBarElement) {\r\n      this.searchBarElement.style.visibility = 'visible';\r\n      (this.searchBarElement.querySelector('input') as HTMLInputElement).select();\r\n      return;\r\n    }\r\n\r\n    this.terminal.element.style.position = 'relative';\r\n    const element = document.createElement('div');\r\n    element.innerHTML = `\r\n       <input type=\"text\" class=\"search-bar__input\" name=\"search-bar__input\"/>\r\n       <button class=\"search-bar__btn prev\"></button>\r\n       <button class=\"search-bar__btn next\"></button>\r\n       <button class=\"search-bar__btn close\"></button>\r\n    `;\r\n    element.className = ADDON_MARKER_NAME;\r\n    const parentElement = <HTMLElement>this.terminal.element.parentElement;\r\n    this.searchBarElement = element;\r\n    if (!['relative', 'absoulte', 'fixed'].includes(parentElement.style.position)) {\r\n      parentElement.style.position = 'relative';\r\n    }\r\n    parentElement.appendChild(this.searchBarElement);\r\n    this.on('.search-bar__btn.close', 'click', () => {\r\n      this.hidden();\r\n    });\r\n    this.on('.search-bar__btn.next', 'click', () => {\r\n      this.searchAddon.findNext(this.searchKey, {\r\n        incremental: false\r\n      });\r\n    });\r\n    this.on('.search-bar__btn.prev', 'click', () => {\r\n      this.searchAddon.findPrevious(this.searchKey, {\r\n        incremental: false\r\n      });\r\n    });\r\n    this.on('.search-bar__input', 'keyup', (e: any) => {\r\n      this.searchKey = (e.target as HTMLInputElement).value;\r\n      this.searchAddon.findNext(this.searchKey, {\r\n        incremental: e.key !== `Enter`\r\n      });\r\n    });\r\n    (this.searchBarElement.querySelector('input') as HTMLInputElement).select();\r\n  }\r\n\r\n  /**\r\n   * You can manually call close, also can click the close button on the bar\r\n   * @memberof SearchBarAddon\r\n   */\r\n  hidden() {\r\n    if (this.searchBarElement && (this.terminal.element as HTMLElement).parentElement) {\r\n      this.searchBarElement.style.visibility = 'hidden';\r\n    }\r\n  }\r\n\r\n  private on(selector: string, event: string, cb: (e: any) => void) {\r\n    const parentElement = <HTMLElement>(this.terminal.element as HTMLElement).parentElement;\r\n    parentElement.addEventListener(event, (e) => {\r\n      let target = e.target;\r\n\r\n      while (target !== document.querySelector(selector)) {\r\n        if (target === parentElement) {\r\n          target = null;\r\n          break;\r\n        }\r\n\r\n        target = (target as HTMLElement).parentElement;\r\n      }\r\n\r\n      if (target === document.querySelector(selector)) {\r\n        cb.call(this, e);\r\n        e.stopPropagation();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * You can customize your own style, and then add CSS string template after search bar init\r\n   * @param {string} newStyle\r\n   * @memberof SearchBarAddon\r\n   */\r\n  addNewStyle(newStyle: string) {\r\n    let styleElement = document.getElementById(ADDON_MARKER_NAME) as HTMLStyleElement;\r\n\r\n    if (!styleElement) {\r\n      styleElement = document.createElement('style');\r\n      styleElement.type = 'text/css';\r\n      styleElement.id = ADDON_MARKER_NAME;\r\n      document.getElementsByTagName('head')[0].appendChild(styleElement);\r\n    }\r\n\r\n    styleElement.appendChild(document.createTextNode(newStyle));\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}